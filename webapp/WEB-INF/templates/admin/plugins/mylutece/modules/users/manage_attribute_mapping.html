<@box>
    <@boxHeader title='#i18n{module.mylutece.users.manage_attribute_mapping.pageTitle}' boxTools=true>
    </@boxHeader>
    <@boxBody>
        <@messages infos=infos />
        <@messages errors=errors />
        <@row>
            <@tform action='jsp/admin/plugins/mylutece/modules/users/ManageLocalUsers.jsp' method='post'>
                <#if attribute_list??>
                    <#list attribute_list as attribute>
                        <@formGroup labelKey='${attribute.title}' helpKey='${attribute.helpMessage!}'
                            mandatory=attribute.mandatory!false>
                            <#assign attributeSelected=getSelected( attribute.idAttribute )>
                            <select class="form-control" name="attribute_mapping_${attribute.idAttribute}">
                                <option value=""></option>
                                <#if provider_attribute_list??>
                                    <#list provider_attribute_list as provider_attribute>
                                        <option value="${provider_attribute}" <#if attributeSelected = provider_attribute>selected=selected</#if>>${provider_attribute}</option>
                                    </#list>
                                </#if>
                            </select>
                        </@formGroup>
                    </#list>
                </#if>
                <@actionButtons button1Name="action_updateAttributeMapping" button2Name="view_manageLocalUsers" />
            </@tform>
        </@row>
    </@boxBody>
</@box>

<#--
-- Get the current provider attribute id mapped with the mylutece attribute
-- @param idMyLuteceAttribute
-- @return the provider attribute id
-->
<#function getSelected idMyLuteceAttribute>
    <#if attribute_mapping_list?has_content>
		<#list attribute_mapping_list as attribute_mapping>
			<#if attribute_mapping.id = idMyLuteceAttribute>
  				<#return attribute_mapping.idProviderAttribute>
  			</#if>
  		</#list>
	</#if>
	<#return "">
</#function>